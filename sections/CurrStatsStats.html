<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DiccChops - Client Stats</title>
  <link rel="stylesheet" href="sections/Stats-style.css">
</head>
<body>
  <div id="stats-page">
    <section class="stats">
      <h3>Real-time Client Stats</h3>
      <p>Stats below are measured directly from your device.</p>
      <ul>
        <li>Memory (JS Heap): <span id="memory">--</span></li>
        <li>Network Type: <span id="network">--</span></li>
        <li>Latency (to server): <span id="latency">--</span></li>
        <li>Browser: <span id="browser">--</span></li>
      </ul>
      <p class="update-note">Data updates every 5 seconds.</p>
    </section>
  </div>

  <script>
  async function updateClientStats() {
    if (performance.memory) {
      const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
      const totalMB = (performance.memory.jsHeapSizeLimit / 1048576).toFixed(0);
      document.getElementById("memory").textContent = `${usedMB} MB / ${totalMB} MB`;
    } else {
      document.getElementById("memory").textContent = "Not supported";
    }

    if (navigator.connection) {
      document.getElementById("network").textContent =
        `${navigator.connection.effectiveType} (${navigator.connection.downlink} Mbps est.)`;
    } else {
      document.getElementById("network").textContent = "Unknown";
    }

    const t0 = performance.now();
    await fetch(window.location.href, { cache: "no-store", mode: "no-cors" }).catch(()=>{});
    const t1 = performance.now();
    document.getElementById("latency").textContent = `${Math.round(t1 - t0)} ms`;

    document.getElementById("browser").textContent = navigator.userAgent;
  }

  updateClientStats();
  setInterval(updateClientStats, 5000);
  </script>
</body>
</html>
