<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Project Zomboid Tileset Maker</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      background: #0f0f0f;
      color: #e6e6e6;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    h1 {
      margin-top: 0;
      font-size: 22px;
      letter-spacing: 0.5px;
    }

    label {
      font-size: 13px;
      color: #bbb;
    }

    input[type="number"],
    input[type="file"] {
      background: #1b1b1b;
      border: 1px solid #333;
      color: #eee;
      padding: 6px;
      margin-top: 4px;
      border-radius: 4px;
    }

    button {
      background: #2b2b2b;
      border: 1px solid #444;
      color: #eee;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #3a3a3a;
    }

    p {
      font-size: 13px;
      color: #aaa;
    }

    #preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
      background: #151515;
      border: 1px solid #2a2a2a;
      border-radius: 6px;
      min-height: 80px;
    }

    #preview > div {
      position: relative;
      background: #1c1c1c;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 6px;
      cursor: grab;
    }

    #preview > div:active {
      cursor: grabbing;
    }

    #preview img {
      display: block;
      image-rendering: pixelated;
    }

    #preview button {
      position: absolute;
      top: -6px;
      right: -6px;
      width: 18px;
      height: 18px;
      padding: 0;
      border-radius: 50%;
      border: none;
      background: #b33;
      color: #fff;
      font-size: 12px;
      line-height: 18px;
      cursor: pointer;
    }

    #preview button:hover {
      background: #d44;
    }

    canvas {
      display: block;
      margin-top: 15px;
      background: #111;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>Project Zomboid Tileset Maker</h1>

  <div>
    <label>Import Sprites (128x256 PNGs):</label><br />
    <input type="file" id="fileInput" multiple accept="image/png" />
    <br /><br />

    <label>Tiles per Row:</label><br />
    <input type="number" id="tilesPerRow" value="8" min="1" />
    <br /><br />

    <button id="buildBtn">Build Tileset</button>
    <button id="downloadBtn">Download PNG</button>
  </div>

  <p>Click and drag tiles to reorder. Click ✕ to remove.</p>

  <div id="preview"></div>
  <br />
  <canvas id="tilesetCanvas"></canvas>

  <script>
    const TILE_W = 128;
    const TILE_H = 256;

    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const canvas = document.getElementById('tilesetCanvas');
    const ctx = canvas.getContext('2d');
    const buildBtn = document.getElementById('buildBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let images = [];
    let draggedIndex = null;

    fileInput.addEventListener('change', e => {
      [...e.target.files].forEach(file => {
        const img = new Image();
        img.onload = () => {
          images.push(img);
          rebuildPreview();
        };
        img.src = URL.createObjectURL(file);
      });
      fileInput.value = '';
    });

    function rebuildPreview() {
      preview.innerHTML = '';

      images.forEach((img, i) => {
        const container = document.createElement('div');
        container.draggable = true;
        container.dataset.index = i;

        const removeBtn = document.createElement('button');
        removeBtn.textContent = '✕';
        removeBtn.onclick = () => {
          images.splice(i, 1);
          rebuildPreview();
        };

        const thumb = document.createElement('img');
        thumb.src = img.src;
        thumb.width = 64;

        container.addEventListener('dragstart', () => {
          draggedIndex = i;
        });

        container.addEventListener('dragover', e => e.preventDefault());

        container.addEventListener('drop', () => {
          const targetIndex = Number(container.dataset.index);
          if (draggedIndex === null || draggedIndex === targetIndex) return;

          const moved = images.splice(draggedIndex, 1)[0];
          images.splice(targetIndex, 0, moved);
          draggedIndex = null;
          rebuildPreview();
        });

        container.appendChild(removeBtn);
        container.appendChild(document.createElement('br'));
        container.appendChild(thumb);
        preview.appendChild(container);
      });
    }

    buildBtn.onclick = () => {
      const perRow = parseInt(document.getElementById('tilesPerRow').value);
      const rows = Math.ceil(images.length / perRow);

      canvas.width = perRow * TILE_W;
      canvas.height = rows * TILE_H;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      images.forEach((img, i) => {
        const x = (i % perRow) * TILE_W;
        const y = Math.floor(i / perRow) * TILE_H;
        ctx.drawImage(img, x, y, TILE_W, TILE_H);
      });
    };

    downloadBtn.onclick = () => {
      const a = document.createElement('a');
      a.download = 'pz_tileset.png';
      a.href = canvas.toDataURL('image/png');
      a.click();
    };
  </script>
</body>
</html>
