<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pageTitle">Loading…</title>
<link rel="icon" href="../../Icon.webp" type="image/webp">
<link rel="stylesheet" href="style.css">

<!-- Model Viewer -->
<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
</head>
<body>

<header>
<nav class="nav-container">
<a href="../../index.html" class="logo">My Portfolio</a>
<div class="links">
<a href="../../index.html">Home</a>
<a href="#portfolio">Portfolio</a>
</div>
</nav>
</header>

<main>
<div class="box">
<h1 id="projectName">Loading…</h1>
<h2>Gallery</h2>

<!-- Environment Dropdown -->
<div class="env-select-wrapper">
<label for="envSelect">Environment:</label>
<select id="envSelect" class="env-select">
    <option value="neutral" selected>Neutral</option>
    <option value="sunset">Sunset</option>
    <option value="studio">Studio</option>
</select>
</div>

<!-- Dynamic Model Viewer -->
<div class="model-wrapper">
    <model-viewer
        id="viewer"
        src="../Ender3Sidebin/Files/SideBinV2.glb"
        poster=""
        alt="3D Model"
        camera-controls
        auto-rotate
        shadow-intensity="1"
        style="width:100%; height:400px; border-radius:10px; background:#2a2a2a;">
    </model-viewer>
    <div class="model-tooltip">Rotate & Zoom</div>
</div>

<p id="projectDescription"></p>
<p><strong>Tags:</strong> <span id="projectTags"></span></p>
<p><strong>Author:</strong> <span id="projectAuthor"></span></p>
<p><strong>Visibility:</strong> <span id="projectVisibility"></span></p>

<h2>Files</h2>
<div id="fileList" class="file-list"></div>
</div>
</main>

<footer>
<p>© 2025 DiccChops.com — All Rights Reserved.</p>
</footer>

<script>
// HDR environments
const viewer = document.getElementById("viewer");
const dropdown = document.getElementById("envSelect");
const environments = {
    neutral: "../HDRs/kloofendal_misty_morning_puresky_4k.hdr",
    sunset: "../HDRs/qwantani_sunset_puresky_4k.hdr",
    studio: "../HDRs/table_mountain_2_puresky_4k.hdr"
};
function setEnvironment(env) {
    viewer.setAttribute("environment-image", environments[env]);
    viewer.style.backgroundColor = "transparent";
}
setEnvironment("neutral");
dropdown.addEventListener("change", () => setEnvironment(dropdown.value));

// Load settings.cfg
async function loadCFG(url) {
    const text = await fetch(url).then(r => r.text());
    const lines = text.split(/\r?\n/);
    const cfg = {};
    let section = null;

    for (let raw of lines) {
        let line = raw.trim();
        if (!line || line.startsWith("#") || line.startsWith(";")) continue;
        if (line.startsWith("[") && line.endsWith("]")) {
            section = line.slice(1, -1);
            cfg[section] = {};
            continue;
        }
        if (section && line.includes("=")) {
            let [key, val] = line.split("=");
            key = key.trim();
            val = val.trim().replace(/^"|"$/g, "");
            cfg[section][key] = val;
        }
    }
    return cfg;
}

// Apply CFG to page
async function initProject() {
    const cfg = await loadCFG("./settings.cfg");

    document.getElementById("projectName").textContent = cfg.meta?.name || "Project";
    document.getElementById("pageTitle").textContent = cfg.meta?.name || "Project";
    document.getElementById("projectDescription").textContent = cfg.meta?.description || "";
    document.getElementById("projectTags").textContent = cfg.meta?.tags || "";
    document.getElementById("projectAuthor").textContent = cfg.meta?.author || "";
    document.getElementById("projectVisibility").textContent = cfg.visibility?.mode || "";

    if (cfg.files?.Glb) viewer.src = `Files/${cfg.files.Glb}`;
    if (cfg.files?.thumbnail) viewer.poster = `Files/${cfg.files.thumbnail}`;

    const fileList = document.getElementById("fileList");
    fileList.innerHTML = "";
    for (const [key, file] of Object.entries(cfg.files || {})) {
        if (key === "Glb" || key === "thumbnail") continue;
        const div = document.createElement("div");
        div.className = "file-item";
        div.innerHTML = `
            <span>${file}</span>
            <a href="./${file}" download><button>Download</button></a>
        `;
        fileList.appendChild(div);
    }
}

initProject();
</script>
</body>
</html>
